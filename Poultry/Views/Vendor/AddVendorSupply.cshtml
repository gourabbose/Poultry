@using Poultry.Models;
@model Stock

@{
    ViewBag.Title = "Add Vendor Supply";
    var _itemList = (SelectList)ViewBag.ItemList;
    var _vendorList = (SelectList)ViewBag.VendorList;
}

<h2>Add Vendor Supply</h2>
<p>
    <input type="button" id="AddItemInput" value="Add More Item" />
    <input type="button" id="AddChicken" value="Add Chickens" />
</p>

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "VendorSupplyForm" }))
{
    <strong>Select Vendor : </strong>
    @Html.DropDownList("VendorId", _vendorList, "Select vendor", new { data_val_required = "Please Select a Vendor first.", data_val = "true" })
    <br />
    <br />
    <div data-valmsg-summary="true" class="validation-summary-valid" id="validationSummary">
        <ul>
            <li style="display: none"></li>
        </ul>
    </div>
    <div id="ChickenContainer">
    </div>
    <div>
        <div id="container" style="padding: 10px; padding-left: 15px;">
            <div class="inputItems">
                <strong>Item : </strong>
                @Html.DropDownList("[0].Item.Id", _itemList, "Select Item", new { data_val_required = "Please ensure you have selected all the items.", data_val = "true" })
                <strong style="padding-left: 5px;">Quantity : </strong>
                @Html.TextBox("[0].Quantity", "", new { data_val_required = "Please ensure you have filled all the quantities.", data_val = "true" })
                @*<span data-valmsg-replace="true" data-valmsg-for="[0].Quantity" class="field-validation-valid"></span>*@
                <a href="javascript:void(0)" class="remove">Remove</a>
            </div>
        </div>
    </div>
    <div>
        <p>
            <input type="submit" value="Add Supply" />
        </p>
    </div>
}
<div style="display: none" id="temp">
    <div class="inputItems">
        <strong>Item : </strong>
        @Html.DropDownList("[0].Item.Id", _itemList, "Select Item", new { data_val_required = "Please ensure you have selected all the items.", data_val = "true" })
        <strong style="padding-left: 5px;">Quantity : </strong>
        @Html.TextBox("[0].Quantity", "", new { data_val_required = "Please ensure you have filled all the quantities.", data_val = "true" })
        <a href="javascript:void(0)" class="remove">Remove</a>
    </div>
</div>
<div id="tempChicken" style="display:none">
    <div>
        <strong style="padding-left: 5px; padding-right: 5px;">Chickens : </strong>
        @Html.TextBox("ChickCount", "", new { data_val_required = "Please enter the count of chicken.", data_val = "true" })
        <a href="javascript:void(0)" class="remove Chicken">Remove</a>
    </div>
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
<script type="text/javascript">
    $(document).ready(function () {
        $('#AddItemInput').click(function () {
            $('#container').append($('#temp').html());
            ReOrder();
        });
        $('#AddChicken').click(function () {
            if ($('#ChickenContainer').find('div').length == 0) {
                $('#ChickenContainer').html($('#tempChicken').html());
                ReOrder();
            }
        });
        $(document).on('click', '.remove', function () {
            $(this).parent().remove();
            if (!$(this).hasClass('Chicken')) {
                CurrentItemNo--;
                ReOrder();
            }
        });
    });
    //$('#validationSummary').on('DOMSubtreeModified', getUniqueValidations);
    function getUniqueValidations() {
        var list = $('#validationSummary').find('li');
        var html = '';
        list.each(function () {
            var count = 0;
            var currentVal = $(this).text();
            if (html.indexOf(currentVal)<0) {
                html += '<li>' + currentVal + '</li>';
            }
        });
        $('#validationSummary').unbind('DOMSubtreeModified');
        Alert(html);
        $('#validationSummary').html(html);
        $('#validationSummary').on('DOMSubtreeModified', getUniqueValidations);
    }
    function ReOrder() {
        var InputItems = $('#container').find('.inputItems');
        var i = 0;
        $(InputItems).each(function () {
            $(this).find('select').attr('name', '[' + i + '].Item.Id');
            $(this).find('input').attr('name', '[' + i + '].Quantity');
            i++;
        });
        var form = $('form#VendorSupplyForm')
                    .removeData("validator") /* added by the raw jquery.validate plugin */
                    .removeData("unobtrusiveValidation");  /* added by the jquery unobtrusive plugin */

        $.validator.unobtrusive.parse('form#VendorSupplyForm');
    }
</script>


